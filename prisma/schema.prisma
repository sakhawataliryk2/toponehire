// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Admin {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model Job {
  id              String   @id @default(cuid())
  title           String
  employer        String
  product         String?
  jobDescription  String   @db.Text
  jobType         String
  categories      String
  location        String   @default("Onsite")
  salaryFrom      String?
  salaryTo        String?
  salaryFrequency String?   @default("yearly")
  howToApply      String   @default("email")
  applyValue      String?
  featured        Boolean  @default(false)
  status          String   @default("Active")
  views           Int      @default(0)
  applications    Int      @default(0)
  postedBy        String   @default("Admin")
  postingDate      DateTime @default(now())
  expirationDate  DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("jobs")
}

model Employer {
  id                String   @id @default(cuid())
  email             String   @unique
  fullName          String
  phone             String
  location          String
  password          String
  companyName       String
  website           String
  logoUrl           String?
  companyDescription String? @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("employers")
}

model JobSeeker {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  location  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  resumes   Resume[]

  @@map("job_seekers")
}

model Resume {
  id                  String   @id @default(cuid())
  jobSeekerId         String
  resumeFileUrl       String?
  desiredJobTitle     String
  jobType             String
  categories          String
  personalSummary     String   @db.Text
  location            String
  phone               String
  letEmployersFind    Boolean  @default(true)
  workExperience      String?  @db.Text // JSON array of work experiences
  education           String?  @db.Text // JSON array of education
  views               Int      @default(0)
  status              String   @default("Active")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  jobSeeker           JobSeeker @relation(fields: [jobSeekerId], references: [id], onDelete: Cascade)

  @@map("resumes")
}

// ---- eCommerce ----
enum ProductType {
  EMPLOYER
  JOB_SEEKER
}

enum BillingInterval {
  MONTHLY
  YEARLY
}

model Product {
  id                     String          @id @default(cuid())
  type                   ProductType
  name                   String
  description            String?        @db.Text
  price                  Decimal         @db.Decimal(10, 2)
  billingInterval        BillingInterval @default(MONTHLY)
  firstMonthFree         Boolean         @default(false)
  postJobs               Boolean         @default(false)
  featuredEmployer       Boolean         @default(false)
  resumeAccess           Boolean         @default(false)
  postResumes            Boolean         @default(false)
  jobAccess              Boolean         @default(false)
  assignedOnRegistration Boolean         @default(false)
  active                 Boolean         @default(true)
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt

  orders                 Order[]

  @@map("products")
}

enum DiscountType {
  PERCENT
  FIXED
}

enum DiscountStatus {
  ACTIVE
  EXPIRED
  NOT_ACTIVE
  PENDING_USED
}

model Discount {
  id         String         @id @default(cuid())
  code       String         @unique
  type       DiscountType
  value      Decimal        @db.Decimal(10, 2)
  maxUses    Int            @default(1)
  usedCount  Int            @default(0)
  startDate  DateTime
  expiryDate DateTime?
  status     DiscountStatus @default(NOT_ACTIVE)
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  @@map("discounts")
}

enum OrderStatus {
  PAID
  UNPAID
}

model Order {
  id             String      @id @default(cuid())
  invoiceNumber  String      @unique
  customerType   ProductType
  employerId     String?
  jobSeekerId    String?
  productId      String
  total          Decimal     @db.Decimal(10, 2)
  paymentMethodId String?
  status         OrderStatus @default(UNPAID)
  createdAt      DateTime    @default(now())

  product        Product     @relation(fields: [productId], references: [id])
  paymentMethod  PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

  @@map("orders")
}

model PaymentMethod {
  id        String   @id @default(cuid())
  name      String
  isActive  Boolean  @default(true)
  config    String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders    Order[]

  @@map("payment_methods")
}

// ---- Listing Fields ----
enum FieldType {
  TEXT_FIELD
  TEXT_AREA
  EMAIL
  PASSWORD
  NUMBER
  DATE
  DROPDOWN
  MULTISELECT
  CHECKBOX
  RADIO
  FILE
  PICTURE
  LOCATION
  COMPLEX
  SOCIAL_NETWORK
  GALLERY
  ACCOUNT_TYPE
}

enum FieldContext {
  EMPLOYER
  JOB_SEEKER
  RESUME
  APPLICATION
  JOB
}

model CustomField {
  id          String      @id @default(cuid())
  caption     String
  type        FieldType
  context     FieldContext
  required    Boolean     @default(false)
  hidden      Boolean     @default(false)
  order       Int         @default(0)
  options     String?     @db.Text // JSON array for dropdown/multiselect options
  placeholder String?
  helpText    String?
  validation  String?    @db.Text // JSON for validation rules
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@map("custom_fields")
}

model Category {
  id              String   @id @default(cuid())
  name            String   @unique
  slug            String   @unique
  description     String?  @db.Text
  caption         String   @default("Categories")
  required        Boolean  @default(true)
  hidden          Boolean  @default(false)
  displayAs       String   @default("MultiList") // MultiList, Dropdown, Checkbox
  maxChoices      Int      @default(0) // 0 = unlimited
  order           Int      @default(0)
  pageTitle       String?
  url             String?
  onetOccupation  String?
  metaDescription String?  @db.Text
  metaKeywords    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("categories")
}

model JobType {
  id              String   @id @default(cuid())
  name            String   @unique
  slug            String   @unique
  description     String?  @db.Text
  caption         String   @default("Job Type")
  required        Boolean  @default(true)
  hidden          Boolean  @default(false)
  displayAs       String   @default("Dropdown")
  maxChoices      Int      @default(1)
  order           Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("job_types")
}
